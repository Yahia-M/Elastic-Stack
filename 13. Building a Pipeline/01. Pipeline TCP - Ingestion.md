## Construire un pipeline Logstash
- Logstash est un pipeline open source léger de traitement des données côté serveur qui vous permet de collecter des données provenant de diverses sources, de les transformer à la volée et de les envoyer vers la destination souhaitée.


 ![ls_pipeline_concept-Page-1](https://user-images.githubusercontent.com/73080397/182131111-9e78312a-36cb-4ff6-bd39-4efd34c3a7fa.png)


- Le But de ce TP est de construire et d'assembler bout à bout un pipeline complet :
- On doit commencer par créer un fichier logstash-tcp.yml
       - Nom de l'index : 'netlog'

- Insérer le contenu suivant dans le fichier logstash-tcp.yml :
```
input
{
    tcp {
          port => 7777
          type => syslog
        }
}

output {
  elasticsearch {
    hosts => [ "adresse-ip-locale:port-elastic-search" ]
    index => "netlog"
  }
  stdout { codec => rubydebug }
}
```
- Pour faire ceci, il faut créer un fichier logstash-tcp.yml et y écrire ce contenu avec un éditeur comme [nano](https://www.geeksforgeeks.org/nano-text-editor-in-linux/) (recommandé pour les débutants) ou [vim](https://linuxtect.com/open-files-in-vim-vi/)
- Nano :
```
nano logstash-tcp.yml
```
- Ctrl+o pour sauvegarder
- Vim :

```
vi logstash-tcp.yml
```
- Cliquer sur 'I' pour insérer
- Coller le contenu
- Cliquer sur echap puis taper :wq pour enregistrer et quitter
- Pour vérifier le contenu de votre fichier:
```
cat logstash-tcp.yml
```

- Lancer votre pipeline logstash : 
```
cd /usr/share/logstash/bin
sudo ./logstash -f /chemin/logstash-tcp.yml
```
- Lancer un autre tab de terminal (split view et se connecter ) 

- Ecrire des messages sur la console et les envoyer via netcat (sur le port 7777) sur le port précédemment paramétré (demander une démo au trainer)
```

sudo yum install nc
sudo nc localhost 7777
MESSAGE 1
MESSAGE 2
MESSAGE 3
```
![working_message](https://user-images.githubusercontent.com/73080397/182189250-2b75009b-f0b1-4c31-9475-743df3163f74.png)

- Vérifier la réception sur logstash (via les logs) et l’envoi à ElasticSearch 
- Vérifier à travers la console de DEV par des requêtes sur netlog

- Constater la création et le remplissage de l’index ‘netlog’
- Monitorer en temps réel via la commande watch
``` 
watch -n0.5 curl -X GET "localhost:9200/nom_de_lindex/_count"
```

